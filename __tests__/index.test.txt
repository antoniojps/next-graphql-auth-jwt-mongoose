import micro from 'micro';
import { apolloServer } from '../pages/api/graphql'
import middleware from './../utils/middlewares/middleware'
import { runAuthenticationTests } from './authentication'

// start test server
function createServer(options = { path: '/api/graphql' }) {
  const app = micro(middleware(apolloServer.createHandler(options)));
  return app
}

const app = createServer()

function runTests (app) {
  afterAll(() => {
    app.close()
    console.log('Closed test server')
  })
  describe('GraphQL', () => {
    // add graphql tests here
    runAuthenticationTests(app)
  })
}

runTests(app)
